{% load static %}
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
  <title>SAWA - Login</title>
  <link rel="icon" href="{% static 'assets/img/logo.png' %}" type="image/png">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    html {
      scroll-behavior: smooth;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .slide-down {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .btn-transition {
      transition: all 0.2s ease;
    }

    .btn-transition:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-input {
      transition: all 0.2s ease;
    }

    .form-input:focus {
      box-shadow: 0 0 0 2px rgba(31, 147, 224, 0.2);
    }

    html {
      scroll-behavior: smooth;
    }

    a {
      transition: color 0.3s ease;
    }

    button,
    .eff {
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .eff:hover,
    button:hover {
      transform: scale(1.05);
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden"
    style='font-family: Inter, "Noto Sans", sans-serif;'>
    <!-- Responsive Navbar with Logo -->
    <header class="fixed top-0 left-0 w-full z-50 bg-white shadow-md fade-in">
      <div
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f0f3f4] px-4 py-3 md:px-10 md:py-3">
        <div class="flex items-center gap-4 text-[#111517]">
          <a href="/" class="hover:text-[#1f93e0] transition-colors eff">
            <div>
              <img src="{% static 'assets/img/complete_logo.png' %}" alt="Logo" style="height: 60px;" />
            </div>
          </a>
        </div>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button id="mobile-menu-button" class="text-[#111517] focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex flex-1 justify-end gap-8">
          <div class="flex gap-2">
            <a href="/">
              <button
                class="btn-transition flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#1f93e0] text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#166bb3]">
                <span class="truncate">Join a Meeting</span>
              </button>
            </a>
            <a href="{% url 'register' %}">
              <button
                class="btn-transition flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#f0f3f4] text-[#111517] text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#e4e7ea]">
                <span class="truncate">Register</span>
              </button>
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile Navigation (hidden by default) -->
      <div id="mobile-menu" class="hidden md:hidden bg-white w-full px-4 pb-4">
        <div class="flex flex-col space-y-3">
        <div class="flex flex-col space-y-4">
          <div class="flex flex-col gap-3 pt-2">
            <a href="/">
              <button
                class="btn-transition w-full flex cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-4 bg-[#1f93e0] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#166bb3]">
                <span class="truncate">Join a Meeting</span>
              </button>
            </a>
            <a href="/register">
              <button
                class="btn-transition w-full flex cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-4 bg-[#f0f3f4] text-[#111517] text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#e4e7ea]">
                <span class="truncate">Register</span>
              </button>
            </a>
          </div>
        </div>

      </div>
      </div>
    </header>
    <script>
      // Mobile menu toggle functionality
      document.getElementById('mobile-menu-button').addEventListener('click', function () {
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenu.classList.toggle('hidden');
      });

      // Close mobile menu when clicking on a link
      document.querySelectorAll('#mobile-menu a').forEach(link => {
        link.addEventListener('click', () => {
          document.getElementById('mobile-menu').classList.add('hidden');
        });
      });
    </script>
    <!-- Signup Form -->
    <div class="layout-container flex h-full grow flex-col pt-[80px]">
      <div class="px-4 md:px-40 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col w-full max-w-[512px] py-5 flex-1 px-4 sm:px-6">
          <div class="@container">
            <div class="@[480px]:px-4 @[480px]:py-3">
              <div
                class="w-full bg-center bg-no-repeat bg-cover flex flex-col justify-end overflow-hidden bg-white @[480px]:rounded-xl min-h-80"
                style='background-image: url("https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1172&q=80");'>
              </div>
            </div>
          </div>
          <!-- Message Section -->
          {% if messages %}
          <div id="message-container" class="px-4 py-3 space-y-3">
            {% for message in messages %}
            <div class="slide-down rounded-xl p-4 text-sm font-medium leading-normal flex items-center
                 {% if message.tags == 'success' %}
                   bg-green-50 text-green-800 border border-green-200
                 {% elif message.tags == 'error' %}
                   bg-red-50 text-red-800 border border-red-200
                 {% elif message.tags == 'warning' %}
                   bg-yellow-50 text-yellow-800 border border-yellow-200
                 {% else %}
                   bg-blue-50 text-blue-800 border border-blue-200
                 {% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                {% if message.tags == 'success' %}
                <path fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  clip-rule="evenodd" />
                {% elif message.tags == 'error' %}
                <path fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                  clip-rule="evenodd" />
                {% elif message.tags == 'warning' %}
                <path fill-rule="evenodd"
                  d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd" />
                {% else %}
                <path fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd" />
                {% endif %}
              </svg>
              {{ message }}
            </div>
            {% endfor %}
          </div>
          {% endif %}
          <h1 class="text-[#111418] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 text-center pb-3 pt-5">
            Welcome to SAWA</h1>
          <form method="post" class="flex flex-col max-w-[480px] mx-auto">
            {% csrf_token %}
            <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">              <label class="flex flex-col min-w-40 flex-1">
                <p class="text-[#111418] text-base font-medium leading-normal pb-2">Email</p>
                <input name="email" type="email" placeholder="name@example.com"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  required />
              </label>
            </div>
            <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">              <label class="flex flex-col min-w-40 flex-1">
                <p class="text-[#111418] text-base font-medium leading-normal pb-2">Password</p>
                <input name="password" type="password" placeholder="Enter your password"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                  required />
              </label>
            </div>
            <div class="flex px-4 py-3">
              <button type="submit"
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#1980e6] text-white text-sm font-bold leading-normal tracking-[0.015em]">
                <span class="truncate">Sign in</span>
              </button>
            </div>
            <p class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center">
              <!-- <a href="{% url 'forget_password' %}" class="text-[#1980e6] font-bold">Forgotten Password?</a> -->
              <a href="#" id="forgot-password-link" class="text-blue-600">Forgotten password?</a>
            </p>
          </form>



          <!-- Step 1: Enter Email Section -->
          <div id="forgot-email-section" class="flex flex-col max-w-[480px] mx-auto" style="display:none;">
            <form id="forgot-email-form" method="post">
              {% csrf_token %}
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Enter your registered email</p>
                  <input name="email" id="forgot-email-input" type="email" placeholder="name@example.com"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="w-full flex flex-col gap-2 sm:flex-row sm:justify-center px-4 sm:px-6 py-3">
                <button type="submit"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#1980e6] text-white text-sm font-bold leading-normal tracking-[0.015em]">
                  <span class="truncate">Send OTP</span>
                </button>
              </div>
              <div id="forgot-email-message" class="px-4 py-2"></div>
            </form>
          </div>

          <!-- Step 2: OTP Section (hidden by default) -->
          <div id="otp-section" class="flex flex-col max-w-[480px] mx-auto" style="display:none;">
            <form id="otp-form" method="post">
              {% csrf_token %}
              <input type="hidden" name="step" value="verify_otp">
              <input type="hidden" name="email" id="otp-email">
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Enter OTP sent to your email</p>
                  <input name="otp" id="otp-input" placeholder="Enter OTP"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="w-full flex flex-col gap-2 sm:flex-row sm:justify-center px-4 sm:px-6 py-3">
                <button type="submit"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#1980e6] text-white text-sm font-bold leading-normal tracking-[0.015em]">
                  <span class="truncate">Verify OTP</span>
                </button>
              </div>
              <div id="otp-message" class="px-4 py-2"></div>
            </form>
          </div>

          <!-- Step 3: Set Password Section (hidden by default) -->
          <div id="set-password-section" class="flex flex-col max-w-[480px] mx-auto" style="display:none;">
            <form id="set-password-form" method="post">
              {% csrf_token %}
              <input type="hidden" name="step" value="set_password">
              <input type="hidden" name="email" id="setpw-email">
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">New Password</p>
                  <input name="new_password" type="password" placeholder="Enter new password"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Confirm Password</p>
                  <input name="confirm_password" type="password" placeholder="Confirm new password"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="w-full flex flex-col gap-2 sm:flex-row sm:justify-center px-4 sm:px-6 py-3">
                <button type="submit"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#1980e6] text-white text-sm font-bold leading-normal tracking-[0.015em]">
                  <span class="truncate">Set New Password</span>
                </button>
              </div>
              <div id="setpw-message" class="px-4 py-2"></div>
            </form>
          </div>

          <p class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center">or</p>
          <!-- <div class="flex justify-center px-4 py-3">
            <a href="{% url 'google_login' %}"
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#f0f2f4] text-[#111418] text-sm font-bold leading-normal tracking-[0.015em]">
              <button
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#f0f2f4] text-[#111418] gap-2 pl-4 text-sm font-bold leading-normal tracking-[0.015em]">
                <div class="text-[#111418]" data-icon="GoogleLogo" data-size="20px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                    viewBox="0 0 256 256">
                    <path
                      d="M224,128a96,96,0,1,1-21.95-61.09,8,8,0,1,1-12.33,10.18A80,80,0,1,0,207.6,136H128a8,8,0,0,1,0-16h88A8,8,0,0,1,224,128Z">
                    </path>
                  </svg>
                </div>
                <span class="truncate">Continue with Google</span>
              </button></a>
          </div> -->
          <p class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center">Don't have an account?
            <a href="{% url 'register' %}" class="text-[#1980e6] font-bold">Sign up</a>
          </p>
          <div class="w-full flex flex-col gap-2 sm:flex-row sm:justify-center px-4 sm:px-6 py-3">
            <button
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-transparent text-[#111418] text-sm font-bold leading-normal tracking-[0.015em]">
            </button>
          </div>




        </div>
      </div>
    </div>
  </div>
  <script>
    setTimeout(() => {
      const messageContainer = document.getElementById('message-container');
      if (messageContainer) {
        messageContainer.style.transition = 'opacity 0.5s ease';
        messageContainer.style.opacity = '0';
        setTimeout(() => messageContainer.remove(), 500); // Remove the element after fade-out
      }
    }, 3000); // 3 seconds
  </script>


  <script>
    // ...existing code...

    document.getElementById('forgot-password-link').addEventListener('click', function (e) {
      e.preventDefault();
      // Hide login form, show email section
      document.querySelector('form[method="post"]').style.display = 'none';
      document.getElementById('forgot-email-section').style.display = 'block';
    });

    // Step 1: Send OTP to Email
    document.getElementById('forgot-email-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const email = document.getElementById('forgot-email-input').value;
      const formData = new FormData();
      formData.append('step', 'send_otp');
      formData.append('email', email);
      formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);

      fetch("{% url 'forget_password' %}", {
        method: "POST",
        body: formData,
      })
        .then(res => res.json())
        .then(data => {
          const msg = document.getElementById('forgot-email-message');
          msg.innerHTML = '';
          if (data.success) {
            msg.innerHTML = `<div class="bg-green-50 text-green-800 border border-green-200 rounded-xl p-3">${data.message}</div>`;
            setTimeout(() => {
              document.getElementById('forgot-email-section').style.display = 'none';
              document.getElementById('otp-section').style.display = 'block';
              document.getElementById('otp-email').value = email;
            }, 1000);
          } else {
            msg.innerHTML = `<div class="bg-red-50 text-red-800 border border-red-200 rounded-xl p-3">${data.error || "Failed to send OTP."}</div>`;
          }
        });
    });

    // Step 2: OTP Verification
    document.getElementById('otp-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);

      fetch("{% url 'forget_password' %}", {
        method: "POST",
        body: formData,
      })
        .then(res => res.json())
        .then(data => {
          const otpMsg = document.getElementById('otp-message');
          otpMsg.innerHTML = '';
          if (data.success) {
            otpMsg.innerHTML = `<div class="bg-green-50 text-green-800 border border-green-200 rounded-xl p-3">${data.message}</div>`;
            setTimeout(() => {
              document.getElementById('otp-section').style.display = 'none';
              document.getElementById('set-password-section').style.display = 'block';
              document.getElementById('setpw-email').value = form.email.value;
            }, 1000);
          } else {
            otpMsg.innerHTML = `<div class="bg-red-50 text-red-800 border border-red-200 rounded-xl p-3">${data.error || "OTP verification failed."}</div>`;
          }
        });
    });

    // Step 3: Set New Password
    document.getElementById('set-password-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);

      fetch("{% url 'forget_password' %}", {
        method: "POST",
        body: formData,
      })
        .then(res => res.json())
        .then(data => {
          const setpwMsg = document.getElementById('setpw-message');
          setpwMsg.innerHTML = '';
          if (data.success) {
            setpwMsg.innerHTML = `<div class="bg-green-50 text-green-800 border border-green-200 rounded-xl p-3">${data.message}</div>`;
            setTimeout(() => {
              window.location.href = "{% url 'login' %}";
            }, 1500);
          } else {
            setpwMsg.innerHTML = `<div class="bg-red-50 text-red-800 border border-red-200 rounded-xl p-3">${data.error || "Password reset failed."}</div>`;
          }
        });
    });
  </script>
</body>

</html>