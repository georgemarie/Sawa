{% load static %}
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
  <title>SAWA - Register</title>
  <link rel="icon" href="{% static 'assets/img/logo.png' %}" type="image/png">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    html {
      scroll-behavior: smooth;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .slide-down {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .btn-transition {
      transition: all 0.2s ease;
    }

    .btn-transition:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-input {
      transition: all 0.2s ease;
    }

    .form-input:focus {
      box-shadow: 0 0 0 2px rgba(31, 147, 224, 0.2);
    }

    html {
      scroll-behavior: smooth;
    }

    a {
      transition: color 0.3s ease;
    }

    button,
    .eff {
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .eff:hover,
    button:hover {
      transform: scale(1.05);
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden"
    style='font-family: Inter, "Noto Sans", sans-serif;'>
    <!-- Responsive Navbar with Logo -->
    <header class="fixed top-0 left-0 w-full z-50 bg-white shadow-md fade-in">
      <div
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f0f3f4] px-4 py-3 md:px-10 md:py-3">
        <div class="flex items-center gap-4 text-[#111517]">
          <a href="/" class="hover:text-[#1f93e0] transition-colors eff">
            <div>
              <img src="{% static 'assets/img/complete_logo.png' %}" alt="Logo" style="height: 60px;" />
            </div>
          </a>
        </div>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button id="mobile-menu-button" class="text-[#111517] focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex flex-1 justify-end gap-8">
          <div class="flex gap-2">
            <a href="/">
              <button
                class="btn-transition flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#1f93e0] text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#166bb3]">
                <span class="truncate">Join a Meeting</span>
              </button>
            </a>
            <a href="{% url 'login' %}">
              <button
                class="btn-transition flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#f0f3f4] text-[#111517] text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#e4e7ea]">
                <span class="truncate">Login</span>
              </button>
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile Navigation (hidden by default) -->
      <div id="mobile-menu" class="hidden md:hidden bg-white w-full px-4 pb-4">
        <div class="flex flex-col space-y-4">
          <div class="flex flex-col gap-3 pt-2">
            <a href="/">
              <button
                class="btn-transition w-full flex cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-4 bg-[#1f93e0] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#166bb3]">
                <span class="truncate">Join a Meeting</span>
              </button>
            </a>
            <a href="{% url 'login' %}">
              <button
                class="btn-transition w-full flex cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-4 bg-[#f0f3f4] text-[#111517] text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#e4e7ea]">
                <span class="truncate">Login</span>
              </button>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Signup Form -->
    <div class="layout-container flex h-full grow flex-col pt-[80px]">
      <div class="px-4 sm:px-10 md:px-40 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col w-full max-w-[512px] py-5 flex-1 px-4 sm:px-6">
          <div class="@container">
            <div class="@[480px]:px-4 @[480px]:py-3">
              <div
                class="w-full bg-center bg-no-repeat bg-cover flex flex-col justify-end overflow-hidden bg-white @[480px]:rounded-xl min-h-80"
                style='background-image: url("https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1172&q=80");'>
              </div>
            </div>
          </div>

          <!-- Message Section -->
          {% if messages %}
          <div id="message-container" class="px-4 py-3 space-y-3">
            {% for message in messages %}
            <div class="slide-down rounded-xl p-4 text-sm font-medium leading-normal flex items-center
                 {% if message.tags == 'success' %}
                   bg-green-50 text-green-800 border border-green-200
                 {% elif message.tags == 'error' %}
                   bg-red-50 text-red-800 border border-red-200
                 {% elif message.tags == 'warning' %}
                   bg-yellow-50 text-yellow-800 border border-yellow-200
                 {% else %}
                   bg-blue-50 text-blue-800 border border-blue-200
                 {% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                {% if message.tags == 'success' %}
                <path fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  clip-rule="evenodd" />
                {% elif message.tags == 'error' %}
                <path fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                  clip-rule="evenodd" />
                {% elif message.tags == 'warning' %}
                <path fill-rule="evenodd"
                  d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd" />
                {% else %}
                <path fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd" />
                {% endif %}
              </svg>
              {{ message }}
            </div>
            {% endfor %}
          </div>
          {% endif %}

          <h1 class="text-[#111418] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 text-center pb-3 pt-5">
            Create a free account</h1>
          <!-- Signup Form -->
          <div id="signup-form-section" class="flex flex-col max-w-[480px] mx-auto">
            <form id="signup-form" method="post" class="flex flex-col max-w-[480px] mx-auto">
              {% csrf_token %}
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">First Name</p>
                  <input name="first_name" placeholder="Enter your first name"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Last Name</p>
                  <input name="last_name" placeholder="Enter your last name"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Email</p>
                  <input name="email" type="email" placeholder="name@example.com"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Phone Number</p>
                  <input name="phone_number" placeholder="Enter your phone number"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal" />
                </label>
              </div>
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Password</p>
                  <input name="password" type="password" placeholder="Enter your password"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Confirm Password</p>
                  <input name="confirm_password" type="password" placeholder="Confirm your password"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Gender</p>
                  <select name="gender"
                    class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required>
                    <option value="">Select Gender</option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                  </select>
                </label>
              </div>
              <div class="flex px-4 py-3">
                <button type="submit"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#1980e6] text-white text-sm font-bold leading-normal tracking-[0.015em]">
                  <span class="truncate">Sign up with email</span>
                </button>
              </div>
            </form>
          </div>

          <!-- OTP Verification Section (hidden by default) -->
          <div id="otp-section" class="flex flex-col max-w-[480px] mx-auto" style="display:none;">
            <!-- <form id="otp-form" method="post" action="{% url 'verify_otp' %}"> -->
            <form id="otp-form" method="post">
              {% csrf_token %}
              <div class="flex flex-wrap items-end gap-4 px-4 sm:px-6 py-3">
                <label class="flex flex-col min-w-40 flex-1">
                  <p class="text-[#111418] text-base font-medium leading-normal pb-2">Enter OTP sent to your email</p>
                  <input name="otp" id="otp-input" placeholder="Enter OTP"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border-none bg-[#f0f2f4] focus:border-none h-14 placeholder:text-[#637588] p-4 text-base font-normal leading-normal"
                    required />
                </label>
              </div>
              <div class="flex px-4 py-3">
                <button type="submit"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#1980e6] text-white text-sm font-bold leading-normal tracking-[0.015em]">
                  <span class="truncate">Verify OTP</span>
                </button>
              </div>
              <div class="flex px-4 py-3">
                <button type="button" id="resend-otp-btn"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#f0f2f4] text-[#1980e6] text-sm font-bold leading-normal tracking-[0.015em]">
                  <span class="truncate">Resend OTP</span>
                </button>
              </div>
            </form>
          </div>
          <p class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center">or</p>
          <!-- <div class="flex justify-center px-4 py-3">
            <a href="{% url 'google_login' %}"
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 flex-1 bg-[#f0f2f4] text-[#111418] text-sm font-bold leading-normal tracking-[0.015em]">
              <button
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#f0f2f4] text-[#111418] gap-2 pl-4 text-sm font-bold leading-normal tracking-[0.015em]">
                <div class="text-[#111418]" data-icon="GoogleLogo" data-size="20px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                    viewBox="0 0 256 256">
                    <path
                      d="M224,128a96,96,0,1,1-21.95-61.09,8,8,0,1,1-12.33,10.18A80,80,0,1,0,207.6,136H128a8,8,0,0,1,0-16h88A8,8,0,0,1,224,128Z">
                    </path>
                  </svg>
                </div>
                <span class="truncate">Continue with Google</span>
              </button></a>
          </div> -->
          <p class="text-[#637588] text-sm font-normal leading-normal pb-3 pt-1 px-4 text-center">
            Already have an account? <a href="{% url 'login' %}" class="text-[#1980e6] font-bold">
              Log in
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mobile menu toggle functionality
    document.getElementById('mobile-menu-button').addEventListener('click', function () {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
    });

    // Close mobile menu when clicking on a link
    document.querySelectorAll('#mobile-menu a').forEach(link => {
      link.addEventListener('click', () => {
        document.getElementById('mobile-menu').classList.add('hidden');
      });
    });

    // Auto-dismiss messages after 5 seconds with fade out
    setTimeout(() => {
      const messageContainer = document.getElementById('message-container');
      if (messageContainer) {
        messageContainer.style.transition = 'opacity 0.5s ease';
        messageContainer.style.opacity = '0';
        setTimeout(() => {
          if (messageContainer) {
            messageContainer.remove();
          }
        }, 500);
      }
    }, 5000);
  </script>


  <script>
    // Intercept signup form submit to show OTP section
    document.getElementById('signup-form').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      // Send signup data via AJAX to backend to trigger OTP
      const response = await fetch("{% url 'register' %}", {
        method: "POST",
        headers: {
          'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
        },
        body: formData,
      });
      const data = await response.json();

      if (data.success) {
        document.getElementById('signup-form-section').style.display = 'none';
        document.getElementById('otp-section').style.display = 'block';
      } else {
        alert(data.error || "Registration failed.");
      }
    });

    // Handle OTP form submit
    document.getElementById('otp-form').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      // Send OTP via AJAX to backend for verification
      const response = await fetch("{% url 'verify_otp' %}", {
        method: "POST",
        headers: {
          'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
        },
        body: formData,
      });
      const data = await response.json();

      if (data.success) {
        window.location.href = "{% url 'login' %}";
      } else {
        alert(data.error || "OTP verification failed.");
      }
    });

    // Resend OTP
    document.getElementById('resend-otp-btn').addEventListener('click', async function () {
      const response = await fetch("{% url 'send_otp' %}", {
        method: "POST",
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: new FormData(document.getElementById('signup-form')),
      });
      const data = await response.json();
      alert(data.message || data.error);
    });


  </script>
</body>

</html>