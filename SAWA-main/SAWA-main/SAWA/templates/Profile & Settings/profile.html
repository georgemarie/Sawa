{% load static %}
<html>

<head>
 <title>SAWA - Profile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="{% static 'assets/img/logo.png' %}" type="image/png">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#1980e6',
              secondary: '#0e161b',
              accent: '#1f93e0',
              dark: '#111418',
              medium: '#637588',
              light: '#e8eef3',
              border: '#dce0e5',
              success: '#10b981'
            }
          }
        }
      }
    </script>
    <style>
      html {
        scroll-behavior: smooth;
      }

    a {
      transition: color 0.3s ease;
    }

    button,
    .eff {
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .eff:hover,
    button:hover {
      transform: scale(1.05);
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 24px;
      border-radius: 12px;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.3s ease-out;
    }

    .profile-picture-upload {
      position: relative;
      display: inline-block;
      cursor: pointer;
    }

    .profile-picture-upload:hover .profile-overlay {
      opacity: 1;
    }

    .profile-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .profile-overlay-icon {
      color: white;
      font-size: 24px;
    }

    .form-input {
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .form-input:focus {
      border-color: #1980e6;
      box-shadow: 0 0 0 3px rgba(25, 128, 230, 0.1);
    }

    .btn-primary {
      background-color: #1980e6;
      transition: background-color 0.3s ease;
    }

    .btn-primary:hover {
      background-color: #1470cc;
    }

    .btn-secondary {
      background-color: #e8eef3;
      transition: background-color 0.3s ease;
    }

    .btn-secondary:hover {
      background-color: #d0dbe7;
    }

    .language-select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1em;
    }

    html {
      scroll-behavior: smooth;
    }

    a {
      transition: color 0.3s ease;
    }

    button,
    .eff {
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .eff:hover,
    button:hover {
      transform: scale(1.05);
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 24px;
      border-radius: 12px;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.3s ease-out;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #111418;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #637588;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #111418;
      font-weight: 500;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e8eef3;
      border-radius: 8px;
      font-size: 14px;
    }

    .form-input:focus {
      outline: none;
      border-color: #1980e6;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    .option-card {
      border: 1px solid #e8eef3;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .option-card:hover {
      border-color: #1980e6;
      background-color: #f8fafc;
    }

    .option-card.selected {
      border-color: #1980e6;
      background-color: #f0f7ff;
    }

    .option-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .option-description {
      font-size: 14px;
      color: #637588;
    }

    .slide-down {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .profile-dropdown {
      display: none;
      position: absolute;
      right: 0;
      margin-top: 0.5rem;
      width: 12rem;
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      z-index: 50;
      animation: fadeIn 0.2s ease-out;
    }

    .profile-dropdown.show {
      display: block;
    }

    /* Styling for the logout button */
    .logout-btn {
      color: #ff5a5f;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logout-widget-icon {
      width: 20px;
      height: 20px;
    }

    .notification-dropdown {
      display: none;
      position: absolute;
      right: 0;
      margin-top: 0.5rem;
      width: 16rem;
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      z-index: 50;
    }

    .notification-dropdown.show {
      display: block;
    }

    .notification-item {
      padding: 4px 16px;
      border-bottom: 1px solid #e8eef3;
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-empty {
      padding: 16px;
      text-align: center;
      color: #637588;
    }

    .notification-icon {
      color: #111418;
    }
  </style>
</head>

<body>
  <header
    class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[#e8eef3] px-10 py-3 bg-white fixed top-0 left-0 w-full z-50">
    <div class="flex items-center gap-4 text-[#0e161b]">

           <a href="/" class="block sm:hidden hover:text-[#1f93e0] transition-colors eff">
      <img src="{% static 'assets/img/logo.png' %}" alt="Logo" style="height: 80px;" />
    </a>

    <a href="/" class="hidden sm:block hover:text-[#1f93e0] transition-colors eff">
          <img src="{% static 'assets/img/complete_logo.png' %}" alt="Logo" style="height: 60px;" />
    </a>
    </div>
    <div class="flex flex-1 justify-end gap-8">
      <div class="flex gap-2">
        <!-- Help Button -->
        <a href="{%url 'help' %}"
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 bg-[#e8eef3] text-[#0e161b] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5"
          title="Help">
          <div class="text-[#0e161b]" data-icon="Question" data-size="20px" data-weight="regular">
            <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
              viewBox="0 0 256 256">
              <path
                d="M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z">
              </path>
            </svg>
          </div>
        </a>

        <!-- Settings Button -->
        <a href="{%url 'settings' %}"
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 bg-[#e8eef3] text-[#0e161b] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5"
          title="Settings">
          <div class="text-[#0e161b]" data-icon="Gear" data-size="20px" data-weight="regular">
            <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
              viewBox="0 0 256 256">
              <path
                d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z">
              </path>
            </svg>
          </div>
        </a>


        <!-- Notification Button with Dropdown -->
        <div class="relative">
          <button id="notificationButton"
            class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 bg-[#e8eef3] text-[#0e161b] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5"
            title="Notifications">
            <div class="notification-icon" data-icon="Bell" data-size="20px" data-weight="regular">
              <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                viewBox="0 0 256 256">
                <path
                  d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z">
                </path>
              </svg>
            </div>
          </button>

          <!-- Notification Dropdown -->
          <div id="notificationDropdown"
            class="notification-dropdown mt-2 w-full max-w-xs bg-white rounded-xl shadow-lg py-1 z-50 border border-[#e8eef3]">
            <div class="notification-empty">
              No current notifications
            </div>
          </div>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", function () {
            const notificationButton = document.getElementById('notificationButton');
            const notificationDropdown = document.getElementById('notificationDropdown');

            // Hide dropdown initially
            notificationDropdown.classList.remove('show');

            notificationButton.addEventListener('click', (e) => {
              e.stopPropagation();
              notificationDropdown.classList.toggle('show');
            });

            // Close dropdown on outside click
            document.addEventListener('click', (e) => {
              if (
                notificationDropdown &&
                !notificationDropdown.contains(e.target) &&
                !notificationButton.contains(e.target)
              ) {
                notificationDropdown.classList.remove('show');
              }
            });
          });
        </script>



        <!-- Profile Dropdown - Replace the existing profile image div -->
        <div class="relative">
          <button id="profileDropdownButton" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
            style='background-image: url("{% if user.profile_picture %}{{ user.profile_picture.url }}{%elif user.gender == "M" %}{% static "assets/img/male-avatar.png" %}{% else %}{% static "assets/img/female-avatar.png" %}{% endif %}");'
            </button>

            <!-- Dropdown menu -->
            <div id="profileDropdown"
              class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg py-1 z-50 border border-[#e8eef3]">
              <div class="px-4 py-2 border-b border-[#e8eef3]">
                <p class="text-sm font-medium text-[#111418] truncate max-w-[200px]">{{ user.first_name }} {{ user.last_name }}</p>
                <p class="text-xs text-[#637588] truncate max-w-[200px]">{{ user.email }}</p>
              </div>
              <a href="/profile" class="block px-4 py-2 text-sm text-[#111418] hover:bg-[#f0f2f4]">Profile</a>
              <a href="/logout" class="block px-4 py-2 text-sm logout-btn hover:bg-[#fff0f0]">
                Logout
              </a>
            </div>
        </div>


      </div>
  </header>

  <div class="pt-[80px] relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-auto"
    style='font-family: Inter, "Noto Sans", sans-serif;'>
    <!-- Message Section -->
    <div id="message-container" class="px-4 py-3">
      {% if messages %}
      {% for message in messages %}
      <div class="slide-down rounded-xl p-4 text-sm font-medium leading-normal flex items-center
                          {% if message.tags == 'success' %}
                              bg-green-50 text-green-800 border border-green-200
                          {% elif message.tags == 'error' %}
                              bg-red-50 text-red-800 border border-red-200
                          {% elif message.tags == 'warning' %}
                              bg-yellow-50 text-yellow-800 border border-yellow-200
                          {% else %}
                              bg-blue-50 text-blue-800 border border-blue-200
                          {% endif %}">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          {% if message.tags == 'success' %}
          <path fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
            clip-rule="evenodd" />
          {% elif message.tags == 'error' %}
          <path fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
            clip-rule="evenodd" />
          {% elif message.tags == 'warning' %}
          <path fill-rule="evenodd"
            d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
            clip-rule="evenodd" />
          {% else %}
          <path fill-rule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
            clip-rule="evenodd" />
          {% endif %}
        </svg>
        {{ message }}
      </div>
      {% endfor %}
      {% endif %}
    </div>
    <script>
      // Auto-dismiss messages after 5 seconds
      setTimeout(() => {
        const messageContainer = document.getElementById('message-container');
        if (messageContainer) {
          messageContainer.style.transition = 'opacity 0.5s ease';
          messageContainer.style.opacity = '0';
          setTimeout(() => messageContainer.remove(), 500); // Remove the element after fade-out
        }
      }, 5000); // 5 seconds
    </script>
    <div class="layout-container flex h-full grow flex-col">
      <div class="px-4 sm:px-8 md:px-40 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col max-w-[960px] flex-1 w-full">
          <form method="post" enctype="multipart/form-data" action="/profile/"
            class="bg-white rounded-xl shadow-sm p-6 md:p-8">
            {% csrf_token %}

            <div class="flex flex-col items-center mb-8">
              <!-- Profile Picture Upload -->
              <div class="profile-picture-upload mb-4 cursor-pointer" onclick="openImageModal()">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-32 w-32"
                  id="profileImagePreview"
                  style='background-image: url("{% if user.profile_picture %}{{ user.profile_picture.url }}{% elif user.gender == "M" %}{% static "assets/img/male-avatar.png" %}{% else %}{% static "assets/img/female-avatar.png" %}{% endif %}");'>
                </div>
                <div class="profile-overlay">
                  <span class="profile-overlay-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                      viewBox="0 0 256 256">
                      <path
                        d="M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm8,136a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H80a8,8,0,0,0,6.66-3.56L100.28,48h55.43l13.63,20.44A8,8,0,0,0,176,72h32a8,8,0,0,1,8,8ZM128,88a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,88Zm0,72a28,28,0,1,1,28-28A28,28,0,0,1,128,160Z">
                      </path>
                    </svg>
                  </span>
                </div>
              </div>

              <h2 class="text-2xl font-bold text-[#0e141b] mb-1">{{ user.first_name }} {{ user.last_name }}</h2>
              <p class="text-[#4e7397]">{{ user.email }}</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <!-- First Name -->
              <div class="form-group">
                <label for="first_name" class="form-label">First Name</label>
                <input type="text" id="first_name" name="first_name"
                  class="form-input w-full p-3 border border-[#d0dbe7] rounded-lg focus:border-[#1980e6] focus:ring-1 focus:ring-[#1980e6]"
                  value="{{ user.first_name|default:'' }}" readonly>
              </div>

              <!-- Last Name -->
              <div class="form-group">
                <label for="last_name" class="form-label">Last Name</label>
                <input type="text" id="last_name" name="last_name"
                  class="form-input w-full p-3 border border-[#d0dbe7] rounded-lg focus:border-[#1980e6] focus:ring-1 focus:ring-[#1980e6]"
                  value="{{ user.last_name|default:'' }}" readonly>
              </div>

              <!-- Email -->
              <div class="form-group">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" name="email"
                  class="form-input w-full p-3 border border-[#d0dbe7] rounded-lg focus:border-[#1980e6] focus:ring-1 focus:ring-[#1980e6]"
                  value="{{ user.email|default:'' }}" readonly>
              </div>

              <!-- Phone Number -->
              <div class="form-group">
                <label for="phone_number" class="form-label">Phone Number</label>
                <input type="tel" id="phone_number" name="phone_number"
                  class="form-input w-full p-3 border border-[#d0dbe7] rounded-lg focus:border-[#1980e6] focus:ring-1 focus:ring-[#1980e6]"
                  value="{{ user.phone_number|default:'' }}" readonly>
              </div>

              <!-- Gender -->
              <div class="form-group">
                <label for="gender" class="form-label">Gender</label>
                <select id="gender" name="gender" disabled
                  class="form-input w-full p-3 border border-[#d0dbe7] rounded-lg focus:border-[#1980e6] focus:ring-1 focus:ring-[#1980e6] bg-gray-100">
                  {% for gender in Gender %}
                  <option value="{{ gender.value }}" {% if user.gender == gender.value %}selected{% endif %}>{{gender.label }}</option>
                  {% endfor %}
                </select>
              </div>

              <!-- Preferred Language -->
              <div class="form-group">
                <label for="preferred_language" class="form-label">Preferred Language</label>
                <select id="preferred_language" name="preferred_language" disabled
                  class="form-input language-select w-full p-3 border border-[#d0dbe7] rounded-lg focus:border-[#1980e6] focus:ring-1 focus:ring-[#1980e6] bg-gray-100">
                  {% for lang in Language %}
                  <option value="{{ lang.value }}" {% if user.preferred_language == lang.value %}selected{% endif %}>{{lang.label }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <!-- Change Password Button -->
            <div class="mb-8">
              <button type="button" onclick="openPasswordModal()"
                class="btn-secondary flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold w-full md:w-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"
                  class="mr-2">
                  <path
                    d="M160,16A80.07,80.07,0,0,0,83.91,120.78L26.34,178.34A8,8,0,0,0,24,184v40a8,8,0,0,0,8,8H72a8,8,0,0,0,8-8V208H96a8,8,0,0,0,8-8V184h16a8,8,0,0,0,5.66-2.34l9.56-9.55A80,80,0,1,0,160,16Zm20,76a16,16,0,1,1-16-16A16,16,0,0,1,180,92Z">
                  </path>
                </svg>
                Change Password
              </button>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col md:flex-row justify-end gap-4">
              <button type="button" id="editButton"
                class="btn-primary flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold text-white">
                Edit Profile
              </button>
              <button type="submit" id="saveButton"
                class="btn-primary hidden flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold text-white">
                Save Changes
              </button>
              <a href="/profile" id="cancelButton"
                class="btn-secondary hidden flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold">
                Cancel
              </a>
            </div>
          </form>

          <script>
            // Enable editing when Edit button is clicked
            document.getElementById('editButton').addEventListener('click', function () {
              // Enable all input fields
              document.querySelectorAll('input, select').forEach(function (element) {
                if (!(element.tagName === 'INPUT' && element.type === 'email')) {
                  element.readOnly = false;
                  element.disabled = false;
                  element.classList.remove('bg-gray-100');
                }
              });

              // Show save and cancel buttons, hide edit button
              document.getElementById('editButton').classList.add('hidden');
              document.getElementById('saveButton').classList.remove('hidden');
              document.getElementById('cancelButton').classList.remove('hidden');

              // Also enable the profile picture upload
              document.querySelector('.profile-picture-upload').style.pointerEvents = 'auto';
              document.querySelector('.profile-overlay').style.opacity = '1';
            });
          </script>

          <!-- Image modal -->
          <div id="imageModal" class="modal">
            <div class="modal-content">
              <div class="modal-header">
                <h3 class="modal-title">Profile Picture</h3>
                <button class="close-btn" onclick="closeImageModal()">&times;</button>
              </div>
              <form id="imageForm" method="post" action="{% url 'update_profile_image' %}"
                enctype="multipart/form-data">
                {% csrf_token %}
                <div class="flex flex-col items-center">
                  <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-32 w-32 mb-4"
                    id="modalImagePreview"
                    style='background-image: url("{% if user.profile_picture %}{{ user.profile_picture.url }}{% elif user.gender == "M" %}{% static "assets/img/male-avatar.png" %}{% else %}{% static "assets/img/female-avatar.png" %}{% endif %}");'>
                  </div>

                  <div class="flex flex-col w-full gap-3">
                    <label for="newProfilePicture"
                      class="btn-secondary flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold cursor-pointer">
                      <input type="file" id="newProfilePicture" name="profile_picture" accept="image/*" class="hidden">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 256 256" class="mr-2">
                        <path
                          d="M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm8,136a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H80a8,8,0,0,0,6.66-3.56L100.28,48h55.43l13.63,20.44A8,8,0,0,0,176,72h32a8,8,0,0,1,8,8ZM128,88a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,88Zm0,72a28,28,0,1,1,28-28A28,28,0,0,1,128,160Z">
                        </path>
                      </svg>
                      Change Picture
                    </label>

                    {% if user.profile_picture %}
                    <button type="button" onclick="deleteProfilePicture()"
                      class="logout-btn flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 256 256" class="mr-2">
                        <path
                          d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192ZM112,104v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Z">
                        </path>
                      </svg>
                      Remove Picture
                    </button>
                    {% endif %}

                    <button type="submit"
                      class="btn-primary flex items-center justify-center rounded-lg h-12 px-6 text-sm font-bold text-white">
                      Save Changes
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const input = document.getElementById('newProfilePicture');
              const preview = document.getElementById('modalImagePreview');

              input.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                  const reader = new FileReader();
                  reader.onload = function (e) {
                    preview.style.backgroundImage = `url('${e.target.result}')`;
                  }
                  reader.readAsDataURL(file);
                }
              });
            });
          </script>


          <!-- Change Password Modal -->
          <div id="passwordModal" class="modal">
            <div class="modal-content">
              <div class="modal-header">
                <h3 class="modal-title">Change Password</h3>
                <button class="close-btn" onclick="closePasswordModal()">&times;</button>
              </div>
              <form id="passwordForm" method="post" action="{% url 'update_password' %}">
                {% csrf_token %}
                <div class="form-group">
                  <label for="current_password" class="form-label">Current Password</label>
                  <input type="password" id="current_password" name="current_password" class="form-input" required>
                </div>
                <div class="form-group">
                  <label for="new_password1" class="form-label">New Password</label>
                  <input type="password" id="new_password1" name="new_password1" class="form-input" required>
                </div>
                <div class="form-group">
                  <label for="new_password2" class="form-label">Confirm New Password</label>
                  <input type="password" id="new_password2" name="new_password2" class="form-input" required>
                </div>
                <div class="modal-actions">
                  <button type="button" class="btn-secondary px-4 py-2 rounded-lg"
                    onclick="closePasswordModal()">Cancel</button>
                  <button type="submit" class="btn-primary px-4 py-2 rounded-lg text-white">Update Password</button>
                </div>
              </form>
            </div>
          </div>

          <script>
            // Profile dropdown toggle
            const profileButton = document.getElementById('profileDropdownButton');
            const profileDropdown = document.getElementById('profileDropdown');

            profileButton.addEventListener('click', (e) => {
              e.stopPropagation();
              profileDropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
              if (!profileDropdown.contains(e.target) && !profileButton.contains(e.target)) {
                profileDropdown.classList.add('hidden');
              }
            });

            // Notification dropdown toggle
            const notificationButton = document.getElementById('notificationButton');
            const notificationDropdown = document.getElementById('notificationDropdown');

            notificationButton.addEventListener('click', (e) => {
              e.stopPropagation();
              notificationDropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
              if (!notificationDropdown.contains(e.target) && !notificationButton.contains(e.target)) {
                notificationDropdown.classList.add('hidden');
              }
            });

            // Profile picture upload
            const profilePictureInput = document.getElementById('profilePictureInput');
            const profileImagePreview = document.getElementById('profileImagePreview');

            profilePictureInput.addEventListener('change', function () {
              if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                  profileImagePreview.style.backgroundImage = `url('${e.target.result}')`;
                }
                reader.readAsDataURL(this.files[0]);
              }
            });

            // Click anywhere on the profile picture container to trigger file input
            document.querySelector('.profile-picture-upload').addEventListener('click', function () {
              profilePictureInput.click();
            });

            // Password modal functions
            function openPasswordModal() {
              document.getElementById('passwordModal').style.display = 'flex';
            }

            function closePasswordModal() {
              document.getElementById('passwordModal').style.display = 'none';
            }

            // Close modal when clicking outside
            window.addEventListener('click', function (event) {
              const modal = document.getElementById('passwordModal');
              if (event.target === modal) {
                closePasswordModal();
              }
            });


            // Image modal functions
            function openImageModal() {
              document.getElementById('imageModal').style.display = 'flex';
            }

            function closeImageModal() {
              document.getElementById('imageModal').style.display = 'none';
            }

            function deleteProfilePicture() {
              if (confirm('Are you sure you want to remove your profile picture?')) {
                fetch('/profile/delete_image/', {
                  method: 'POST',
                  headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json'
                  }
                })
                  .then(response => response.json())
                  .then(data => {
                    if (data.success) {
                      // Update both previews to show default image based on gender
                      const defaultImage = "{% if user.gender == 'M' %}{% static 'assets/img/male-avatar.png' %}{% else %}{% static 'assets/img/female-avatar.png' %}{% endif %}";
                      document.getElementById('profileImagePreview').style.backgroundImage = `url('${defaultImage}')`;
                      document.getElementById('modalImagePreview').style.backgroundImage = `url('${defaultImage}')`;
                      closeImageModal();
                      // Show success message
                      showMessage('Profile picture removed successfully', 'success');
                    } else {
                      showMessage(data.error || 'Failed to remove profile picture', 'error');
                    }
                  })
                  .catch(error => {
                    console.error('Error:', error);
                    showMessage('An error occurred while removing profile picture', 'error');
                  });
              }
            }

            // Handle file selection in modal
            document.getElementById('newProfilePicture').addEventListener('change', function () {
              if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                  document.getElementById('modalImagePreview').style.backgroundImage = `url('${e.target.result}')`;
                }
                reader.readAsDataURL(this.files[0]);
              }
            });

            // Function to show messages
            function showMessage(message, type) {
              const container = document.getElementById('message-container');
              const messageDiv = document.createElement('div');
              messageDiv.className = `slide-down rounded-xl p-4 text-sm font-medium leading-normal flex items-center mb-2 ${type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-50 text-red-800 border border-red-200' :
                  'bg-blue-50 text-blue-800 border border-blue-200'
                }`;

              messageDiv.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
      ${type === 'success' ? '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />' :
                  type === 'error' ? '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />' :
                    '<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />'}
    </svg>
    ${message}
  `;

              container.prepend(messageDiv);

              // Auto-remove after 5 seconds
              setTimeout(() => {
                messageDiv.style.transition = 'opacity 0.5s ease';
                messageDiv.style.opacity = '0';
                setTimeout(() => messageDiv.remove(), 500);
              }, 5000);
            }
          </script>
</body>

</html>